<!DOCTYPE html>
<html>
  <head>
    <script src="jspsych-6.3.1/jspsych.js"></script>
    <script src="jspsych-6.3.1/plugins/jspsych-survey-likert.js"></script>
    <script src="jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.3.1/plugins/jspsych-survey-text.js"></script>
    <link rel="stylesheet" href="jspsych-6.3.1/css/jspsych.css">
  </head>
  <body>
    <script>
      /* experiment parameters */
      var FIXATION_DURATION = 500;
      var string_num = 1;
      var NUM_TRIALS = string_num*4;

      var demographicQuestions = {
  type: 'survey-text',
  questions: [
    {prompt: "Name:", placeholder: "Enter your name here"},
    {prompt: "Year:", placeholder: "e.g., Freshman, 2023, etc."},
    {prompt: "Major:", placeholder: "Enter your major here"}
  ],
  on_finish: function(data) {
    jsPsych.data.get().localSave('csv', 'psychology_test_data.csv')
  }
};

      /* create cover story */
      var coverStory = {
        type: 'html-keyboard-response',
        stimulus: `<p>Imagine you are a space rescuer whose job is to search for astronauts lost in deep space. Our fleet of spaceships are all equipped with radio transmitters, which can be operated by the astronaut in case they are in need of rescue. To call for help, astronauts can use the transmitter to send out sequences made of two types of radio waves— Lambda (Λ) and Gamma (Γ). However, both types of waves may also be produced by natural phenomena, such as celestial body activities—in this case, Λ and Γ are equally likely to appear. Everyone in space knows that by current technical standard, radio receivers can only pick up [10] waves in a row— that is, you can only detect sequences that have [10] waves (as mentioned before, each wave is either Λ or Γ). If you receive a sequence and think it was produced by natural phenomena, you will ignore it and stay on course. If you think it came from humans, then we will send a rescue team. In this study, you will see about 250 sequences. Your task is to decide whether each sequence was generated by a natural phenomenon or by a human astronaut. Please answer as quickly and accurately as possible!</p>
          <p>Press any key to continue.</p>`
      };

      /* create instructions */
      var instructions = {
        type: 'html-keyboard-response',
        stimulus: `<p>In the following experiment, you will be shown strings and asked to rate their randomness.</p>
          <p>Rate the randomness of each string on a scale from 1 (nonrandom) to 5 (very random).</p>
          <p>Press any key to begin.</p>`
      };

      /* create the task components */
      var fixation = {
        type: 'html-keyboard-response',
        stimulus: '<p style="font-size: 48px; font-family: monospace;">+</p>',
        choices: jsPsych.NO_KEYS,
        trial_duration: FIXATION_DURATION
      };
   

var numpool = [{"00000000":"00000001"},{"00000000":"00000010"},{"00000000":"00000011"},{"00000000":"00000100"},{"00000000":"00000101"},{"00000000":"00000110"},{"00000000":"00000111"},{"00000000":"00001000"},{"00000000":"00001001"},{"00000000":"00001010"},{"00000000":"00001011"},{"00000000":"00001100"},{"00000000":"00001101"},{"00000000":"00001110"},{"00000000":"00001111"},{"00000000":"00010000"},{"00000000":"00010001"},{"00000000":"00010010"},{"00000000":"00010011"},{"00000000":"00010100"},{"00000000":"00010101"},{"00000000":"00010110"},{"00000000":"00010111"},{"00000000":"00011000"},{"00000000":"00011001"},{"00000000":"00011010"},{"00000000":"00011011"},{"00000000":"00011100"},{"00000000":"00011101"},{"00000000":"00011110"},{"00000000":"00011111"},{"00000000":"00100000"},{"00000000":"00100001"},{"00000000":"00100010"},{"00000000":"00100011"},{"00000000":"00100100"},{"00000000":"00100101"},{"00000000":"00100110"},{"00000000":"00100111"},{"00000000":"00101000"},{"00000000":"00101001"},{"00000000":"00101010"},{"00000000":"00101011"},{"00000000":"00101100"},{"00000000":"00101101"},{"00000000":"00101110"},{"00000000":"00101111"},{"00000000":"00110000"},{"00000000":"00110001"},{"00000000":"00110010"},{"00000000":"00110011"},{"00000000":"00110100"},{"00000000":"00110101"},{"00000000":"00110110"},{"00000000":"00110111"},{"00000000":"00111000"},{"00000000":"00111001"},{"00000000":"00111010"},{"00000000":"00111011"},{"00000000":"00111100"},{"00000000":"00111101"},{"00000000":"00111110"},{"00000000":"00111111"},{"00000000":"01000000"},{"00000000":"01000001"},{"00000000":"01000010"},{"00000000":"01000011"},{"00000000":"01000100"},{"00000000":"01000101"},{"00000000":"01000110"},{"00000000":"01000111"},{"00000000":"01001000"},{"00000000":"01001001"},{"00000000":"01001010"},{"00000000":"01001011"},{"00000000":"01001100"},{"00000000":"01001101"},{"00000000":"01001110"},{"00000000":"01001111"},{"00000000":"01010000"},{"00000000":"01010001"},{"00000000":"01010010"},{"00000000":"01010011"},{"00000000":"01010100"},{"00000000":"01010101"},{"00000000":"01010110"},{"00000000":"01010111"},{"00000000":"01011000"},{"00000000":"01011001"},{"00000000":"01011010"},{"00000000":"01011011"},{"00000000":"01011100"},{"00000000":"01011101"},{"00000000":"01011110"},{"00000000":"01011111"},{"00000000":"01100000"},{"00000000":"01100001"},{"00000000":"01100010"},{"00000000":"01100011"},{"00000000":"01100100"},{"00000000":"01100101"},{"00000000":"01100110"},{"00000000":"01100111"},{"00000000":"01101000"},{"00000000":"01101001"},{"00000000":"01101010"},{"00000000":"01101011"},{"00000000":"01101100"},{"00000000":"01101101"},{"00000000":"01101110"},{"00000000":"01101111"},{"00000000":"01110000"},{"00000000":"01110001"},{"00000000":"01110010"},{"00000000":"01110011"},{"00000000":"01110100"},{"00000000":"01110101"},{"00000000":"01110110"},{"00000000":"01110111"},{"00000000":"01111000"},{"00000000":"01111001"},{"00000000":"01111010"},{"00000000":"01111011"},{"00000000":"01111100"},{"00000000":"01111101"},{"00000000":"01111110"},{"00000000":"01111111"},{"00000000":"10000000"},{"00000000":"10000001"},{"00000000":"10000010"},{"00000000":"10000011"},{"00000000":"10000100"},{"00000000":"10000101"},{"00000000":"10000110"},{"00000000":"10000111"},{"00000000":"10001000"},{"00000000":"10001001"},{"00000000":"10001010"},{"00000000":"10001011"},{"00000000":"10001100"},{"00000000":"10001101"},{"00000000":"10001110"},{"00000000":"10001111"},{"00000000":"10010000"},{"00000000":"10010001"},{"00000000":"10010010"},{"00000000":"10010011"},{"00000000":"10010100"},{"00000000":"10010101"},{"00000000":"10010110"},{"00000000":"10010111"},{"00000000":"10011000"},{"00000000":"10011001"},{"00000000":"10011010"},{"00000000":"10011011"},{"00000000":"10011100"},{"00000000":"10011101"},{"00000000":"10011110"},{"00000000":"10011111"},{"00000000":"10100000"},{"00000000":"10100001"},{"00000000":"10100010"},{"00000000":"10100011"},{"00000000":"10100100"},{"00000000":"10100101"},{"00000000":"10100110"},{"00000000":"10100111"},{"00000000":"10101000"},{"00000000":"10101001"},{"00000000":"10101010"},{"00000000":"10101011"},{"00000000":"10101100"},{"00000000":"10101101"},{"00000000":"10101110"},{"00000000":"10101111"},{"00000000":"10110000"},{"00000000":"10110001"},{"00000000":"10110010"},{"00000000":"10110011"},{"00000000":"10110100"},{"00000000":"10110101"},{"00000000":"10110110"},{"00000000":"10110111"},{"00000000":"10111000"},{"00000000":"10111001"},{"00000000":"10111010"},{"00000000":"10111011"},{"00000000":"10111100"},{"00000000":"10111101"},{"00000000":"10111110"},{"00000000":"10111111"},{"00000000":"11000000"},{"00000000":"11000001"},{"00000000":"11000010"},{"00000000":"11000011"},{"00000000":"11000100"},{"00000000":"11000101"},{"00000000":"11000110"},{"00000000":"11000111"},{"00000000":"11001000"},{"00000000":"11001001"},{"00000000":"11001010"},{"00000000":"11001011"},{"00000000":"11001100"},{"00000000":"11001101"},{"00000000":"11001110"},{"00000000":"11001111"},{"00000000":"11010000"},{"00000000":"11010001"},{"00000000":"11010010"},{"00000000":"11010011"},{"00000000":"11010100"},{"00000000":"11010101"},{"00000000":"11010110"},{"00000000":"11010111"},{"00000000":"11011000"},{"00000000":"11011001"},{"00000000":"11011010"},{"00000000":"11011011"},{"00000000":"11011100"},{"00000000":"11011101"},{"00000000":"11011110"},{"00000000":"11011111"},{"00000000":"11100000"},{"00000000":"11100001"},{"00000000":"11100010"},{"00000000":"11100011"},{"00000000":"11100100"},{"00000000":"11100101"},{"00000000":"11100110"},{"00000000":"11100111"},{"00000000":"11101000"},{"00000000":"11101001"},{"00000000":"11101010"},{"00000000":"11101011"},{"00000000":"11101100"},{"00000000":"11101101"},{"00000000":"11101110"},{"00000000":"11101111"},{"00000000":"11110000"},{"00000000":"11110001"},{"00000000":"11110010"},{"00000000":"11110011"},{"00000000":"11110100"},{"00000000":"11110101"},{"00000000":"11110110"},{"00000000":"11110111"},{"00000000":"11111000"},{"00000000":"11111001"},{"00000000":"11111010"},{"00000000":"11111011"},{"00000000":"11111100"},{"00000000":"11111101"},{"00000000":"11111110"},{"00000000":"11111111"}];
      /* Randomly select trials without repetition */
      function getRandomTrials(array, numTrials) {
        var shuffledArray = array.slice().sort(function () {
          return 0.5 - Math.random();
        });
        return shuffledArray.slice(0, numTrials);
      }



      // Add cover story to main timeline
      var mainTimeline = [];
      mainTimeline.push(demographicQuestions)
      mainTimeline.push(coverStory);

      var randomizedTrials = getRandomTrials(numpool, NUM_TRIALS);

      if (randomizedTrials === "00000000" || randomizedTrials === "11111111") {
        numpool.push({ "00000000": randomizedTrials });
    } else {
        for (let j = 0; j < 6; j++) {
            numpool.push({ "00000000": randomizedTrials });
        }
    }

    console.log(numpool)

      // Add instructions to main timeline
      mainTimeline.push(instructions);

// Create an array of condition descriptions
var conditionDescriptions = [
  "In the quadrant you are currently monitoring, the astronauts are trained to be vigilant and to always accept help. When the emergency protocol is triggered, they will follow guidelines and send distress signals, as they very much want help to arrive.",
  "In the quadrant you are currently monitoring, the astronauts are trained to be unafraid and are reluctant to accept help when the emergency protocol is triggered. They will follow guidelines and send distress signals but do not really want help to arrive.",
  "In the quadrant you are currently monitoring, astronauts have a detailed, up-to-date instruction manual for what to do in case of an emergency. As a result, the astronauts know that the signals should be non-random sequences since only then do the rescue ships recognize the sequences as a distress signal.",
  "In the quadrant you are currently monitoring, astronauts have an instruction manual for what to do in case of an emergency but it has some unfortunate omissions. As a result, the astronauts don’t know that the signals should be non-random sequences, since only then do the rescue ships recognize the sequences as a distress signal.",
  "In the quadrant you are currently monitoring, each member of the team is well-trained to use the transmission equipment. Even though the equipment can be difficult to operate when in zero gravity and while wearing bulky gloves, the astronauts are highly skilled at executing the radio transmissions they want to send.",
  "In the quadrant you are currently monitoring, no member of the team has been trained to use the transmission equipment. The equipment can be difficult to operate when in zero gravity and wearing bulky gloves, so the astronauts are often unable to execute the radio transmissions they want to send.",
  "In the quadrant you are currently monitoring, one of the reasons why a distress signal may be triggered is because of a life support malfunction. To stay fully conscious astronauts are equipped with oxygen tanks.  As a result, when they are sending a radio transmission, they are fully aware of what they are doing.",
  "In the quadrant you are currently monitoring, one of the reasons why a distress signal may be triggered is because of a life support malfunction.  In such as state, astronauts will often drift in and out of consciousness.  As a result, when they are sending a radio transmission, they may not be fully aware of what they are doing."
];

var NUM_STORIES_PER_VERSION = 4;
var NUM_VERSIONS = 70;
var versions = [];

for (var i = 0; i < conditionDescriptions.length; i++) {
  for (var j = i + 1; j < conditionDescriptions.length; j++) {
    for (var k = j + 1; k < conditionDescriptions.length; k++) {
      for (var l = k + 1; l < conditionDescriptions.length; l++) {
        var version = [conditionDescriptions[i], conditionDescriptions[j], conditionDescriptions[k], conditionDescriptions[l]];
        versions.push(version);
      }
    }
  }
}

function shuffleArray(array) {
  for (var i = array.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var temp = array[i];
    array[i] = array[j];
    array[j] = temp;
  }
}
shuffleArray(versions);

// Assign version numbers to each combination
for (var i = 0; i < NUM_VERSIONS; i++) {
  versions[i].unshift('VERSION ' + (i + 1));
}

// Now, the 'versions' array contains all 70 versions, each with a version number and 4 stories in random order
console.log(versions);

//a function that select story index from 1 to 8
function getRandomNumberWithoutRepetition(usedNumbers) {
  var allNumbers = [1, 2, 3, 4, 5, 6, 7, 8];
  var availableNumbers = allNumbers.filter((num) => !usedNumbers.includes(num));

  if (availableNumbers.length === 0) {
    // All numbers have been used, reset the usedNumbers array
    usedNumbers.length = 0;
    availableNumbers = allNumbers;
  }

  var randomIndex = Math.floor(Math.random() * availableNumbers.length);
  var selectedNumber = availableNumbers[randomIndex];

  // Add the selected number to the usedNumbers array
  usedNumbers.push(selectedNumber);

  return selectedNumber;
}

// Create a loop to iterate over the randomized trials
for (var i = 0; i < randomizedTrials.length; i++) {
  // Add condition description every string_num trials
  if (i % string_num === 0) {
    var usedNumbers = [];
    var NUM_CONDITIONS = 8; // Total number of conditions
    var conditionIndex = getRandomNumberWithoutRepetition(usedNumbers);
    var conditionDescription = {
      type: 'html-keyboard-response',
      stimulus: '<p>' + conditionDescriptions[conditionIndex] + '</p>' +
                '<p>Press any key to continue.</p>'
    };
    mainTimeline.push(conditionDescription);
  }

  
  // Extract the string from the object
  var string = Object.values(randomizedTrials[i])[0];

  // Create a trial object
  var trial = {
    type: 'survey-likert',
    questions: [{
      prompt: string,
      labels: ['1', '2', '3', '4', '5']
    }],
    data: {
      stimulus: string,
      task: 'rating'
    }
  };

  // Add the trial object to the timeline
  mainTimeline.push(fixation, trial);
}

      /* create the end screen */
      var end = {
        type: 'html-keyboard-response',
        stimulus: `<p>You're done! A .csv file containing your data should be automatically downloading right now.
          Check your default downloads location to find it. Once you've found it, you can close the experiment.</p>`,
        on_load: function() {
          jsPsych.data.get().localSave('csv', 'psychology_test_data.csv');
        }
      };

      /* add end screen to main timeline */
      mainTimeline.push(end);

      /* run the experiment */
      jsPsych.init({
        timeline: mainTimeline,
        experiment_width: 850
      });
    </script>
  </body>
</html>
